/*!build time : 2014-09-26 12:09:50 PM*/
KISSY.add("kg/reactive/0.2.1/index",function(){function a(){}function b(a,b){for(var c=0,d=a.length;d>c;c++)if(a[c]===b)return c;return-1}function c(a,b){for(var c in b)a[c]=b[c];return a}function d(a,b){return function(){a.apply(b,arguments)}}function e(a){var b=this;this._listeners=[],this._endListeners=[],this._subscribeFn=a,this._children=[],this._pushEvent=d(g,b),this._unSubscribeFn=null,this._event=null}function f(a,b){if(a.handler&&(b=a.handler(b)),a._event=b,b)for(var c=a._listeners.concat(),d=0,e=c.length;e>d;d++)b.currentTarget=a,c[d].fn.call(c[d].context,b)}function g(a){var b=this;a===r.END?(j(b),m(b)):(a={value:a,currentTarget:b,target:b},f(b,a))}function h(a){f(this,a)}function i(b){if(!b._listeners.length){b._unSubscribeFn=b._subscribeFn?b._subscribeFn(b._pushEvent):a;for(var c=b._children,d=0,e=c.length;e>d;d++)c[d].on(h,b)}}function j(a){if(!a._listeners.length){for(var b=a._children,c=0,d=b.length;d>c;c++)b[c].detach(h,a);a._unSubscribeFn(),a._unSubscribeFn=null}}function k(a,b){a._endListeners.push(b)}function l(a,c){var d=b(a._endListeners,c);-1!==d&&a._endListeners.splice(d,1)}function m(a){for(var b=a._endListeners.concat(),c=0,d=b.length;d>c;c++)b[c]()}function n(a,c){function d(){var f=b(e,c);-1!==f&&e.splice(f,1),0===e.length&&m(a),l(c,d)}var e=a._children;e.push(c),k(c,d),a._unSubscribeFn&&c.on(h,a)}function o(a,b,c){for(var d=a._listeners,e=0,f=d.length;f>e;e++)if(d[e].fn===b&&d[e].context===c)return e;return-1}function p(a){var b,c=this,d=c._events,e=a.target,f=c._children,g=f.length;for(b=0;g>b;b++)if(f[b]===e){d[b]=a;break}if(g===d.length){var h=[];for(b=0;g>b;b++){if(!d[b])return;h[b]=d[b].value}return{target:this,currentTarget:this,value:h}}}function q(){e.apply(this,arguments)}var r={END:{}};return c(e.prototype,{isEventStream:1,filter:function(a){var b=new this.constructor;return b.handler=function(b){var c=a(b.value);return c?{target:b.target,value:b.value}:void 0},n(b,this),b},map:function(a){var b=this,c=new b.constructor;return c.handler=function(d){if(b!==d.currentTarget)return d;var e=d.value,f=a(e);return f&&f.isEventStream?void n(c,f):{target:d.target,value:f}},n(c,b),c},startsWith:function(a){var b=this;return b._event||(b._event={value:a,currentTarget:b,target:b}),b},onValue:function(a,b){var c=this;b=b||this;var d=function(c){a.call(b,c.value)};return this.on(d,b),function(){c.detach(d,b)}},on:function(a,b){return i(this),b=b||this,-1===o(this,a,b)&&this._listeners.push({fn:a,context:b}),this},detach:function(a,b){b=b||this;var c=this._listeners,d=o(this,a,b);return-1!==d&&c.splice(d,1),j(this),this},combine:function(){var a=arguments,b=new q;b._events=[],b.handler=p,n(b,this);for(var c=0,d=a.length;d>c;c++)n(b,a[c]);return b}}),a.prototype=e.prototype,q.prototype=new a,c(q.prototype,{constructor:q,on:function(a,b){e.prototype.on.apply(this,arguments),this._event&&a.call(b,this._event)}}),r.createEventStream=function(a){return new e(a)},r.createProperty=function(a){return new q(a)},r});